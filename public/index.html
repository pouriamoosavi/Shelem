<!DOCTYPE html>
<html>

<head>
  <title>Shelem</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery.min.js" type="text/javascript"></script>
  <script src="/bootstrap/js/bootstrap.js" type="text/javascript"></script>
  <script src="bootbox/bootbox.min.js"></script>
  <script src="/js/socket.io.js"></script>
</head>
<body>
<table style="width: 100vw; height: 100vh;">
  <tbody>
    <tr style="height: 5vh;">
      <td class="text-center" colspan="3">
        <div id="frontPlayer" data-name=""></div>
      </td>
    </tr>
    <tr style="height: 65%;">
      <td style="width: 7vh;">
        <div style="transform: rotate(-90deg);" id="leftPlayer" data-name=""></div>
      </td>
      <td></td>
      <td style="width: 7vh;">
        <div style="transform: rotate(-90deg);" id="rightPlayer" data-name=""></div>
      </td>
    </tr>
    <tr style="height: 25%;">
      <td colspan="3" id="me"></td>
    </tr>
  </tbody>
</table>
<script>
  var socket = io.connect('/');
  var myCards = [];

  $(document).ready(function() {
    bootbox.prompt({ 
      size: "small",
      title: "What is your name?",
      callback: function(result){ 
        if(result) {
          socket.emit('join', { myName: result });
        }
      }
    });
  })
  
  function renderMe() {
    var html = '<table class="table" style="width: 84vw;"><tr>';
    for(var i in myCards) {
      html += (`<td style="padding: 0px;"><img class="img-responsive" src="/images/cards/${myCards[i].img}.svg" style="width:7vw;"/>`)
    }
    html += '</tr>'
    $('#me').html(html)
  }

  socket.on('newUserJoined', function(data) {
    showAfterUsers(data.user)
  })

  socket.on('youJoined', function(data) {
    showBeforeUsers(data.otherUsers)

    myCards = data.cards;
    $('#joined').show();
  })

  socket.on('startGame', function(data) {
    renderMe();
  })

  socket.on('read', function(data) {
    bootbox.prompt({ 
      size: "small",
      title: "Read: (-1 for pass)",
      callback: function(result){ 
        if(result) {
          socket.emit('read', { read: result });
        } else {
          socket.emit('read', { read: -1 });
        }
      }
    });
  })

  socket.on('otherPlayerRead', function(data) {
    console.log(data)
    let {name, read} = data;
    console.log(name, read)
    $(`div[data-name="${name}"]`).append('- ' + read);
  })

  function showBeforeUsers(users) {
    console.log(users)
    if(users[users.length-1]) {
      $('#rightPlayer').html(users[users.length-1])
      $('#rightPlayer').attr('data-name', users[users.length-1]) 
    }
    if(users[users.length-2]) {
      $('#frontPlayer').html(users[users.length-2])
      $('#frontPlayer').attr('data-name', users[users.length-2])
    }
    if(users[users.length-3]) {
      $('#leftPlayer').html(users[users.length-3])
      $('#leftPlayer').attr('data-name', users[users.length-3])
    }
  }

  function showAfterUsers(user) {
    if(!$('#leftPlayer').html()) {
      $('#leftPlayer').html(user.name)
      $('#leftPlayer').attr('data-name', user.name)
    } else if(!$('#frontPlayer').html()){
      $('#frontPlayer').html(user.name)
      $('#frontPlayer').attr('data-name', user.name)
    } else if(!$('#rightPlayer').html()) {
      $('#rightPlayer').html(user.name)
      $('#rightPlayer').attr('data-name', user.name)
    }
  }

  // function getWidth() {
  //   return Math.max(
  //     document.body.scrollWidth,
  //     document.documentElement.scrollWidth,
  //     document.body.offsetWidth,
  //     document.documentElement.offsetWidth,
  //     document.documentElement.clientWidth
  //   );
  // }

  // function getHeight() {
  //   return Math.max( 
  //     document.body.scrollHeight, 
  //     document.body.offsetHeight, 
  //     document.documentElement.clientHeight, 
  //     document.documentElement.scrollHeight, 
  //     document.documentElement.offsetHeight 
  //   );
  // }
</script>
</body>
</html>